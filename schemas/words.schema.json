{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://asrprogram.dev/schemas/words.schema.json",
  "title": "ASRProgram Word Result Schema v1",
  "description": "约束词级转写结果的顶层结构，确保字段兼容性与向后兼容策略。",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema",
    "language",
    "audio",
    "backend",
    "meta",
    "words",
    "generated_at"
  ],
  "properties": {
    "schema": {
      "const": "asrprogram.wordset.v1",
      "description": "固定的 schema 标识，作为版本协商的显式契约。"
    },
    "language": {
      "type": "string",
      "minLength": 1,
      "description": "转写语言代码，可为 auto 或具体语言（ISO-639-1/2）。"
    },
    "audio": {
      "$ref": "#/$defs/audioInfo",
      "description": "音频元信息块，描述输入源及其持续时间。"
    },
    "backend": {
      "$ref": "#/$defs/backendInfo",
      "description": "记录产生结果的后端名称、模型与版本。"
    },
    "meta": {
      "type": "object",
      "description": "附加元信息，允许写入后处理统计、schema_version 等键值。"
    },
    "words": {
      "type": "array",
      "description": "词级条目数组，按时间顺序排列。",
      "items": {
        "$ref": "#/$defs/wordEntry"
      }
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "UTC 时间戳，指示生成该 JSON 的时间，使用 ISO8601。"
    }
  },
  "$defs": {
    "audioInfo": {
      "type": "object",
      "description": "描述音频输入的核心属性。",
      "required": [
        "path",
        "duration_sec",
        "language"
      ],
      "additionalProperties": false,
      "properties": {
        "path": {
          "type": "string",
          "minLength": 1,
          "description": "原始音频的路径或 URI，保留执行当时的绝对路径。"
        },
        "duration_sec": {
          "type": "number",
          "minimum": 0,
          "description": "音频持续时长，单位为秒，非负浮点数。"
        },
        "language": {
          "type": "string",
          "minLength": 1,
          "description": "后端判定或 CLI 指定的语言代码。"
        },
        "hash_sha256": {
          "type": [
            "string",
            "null"
          ],
          "description": "可选的输入文件 SHA-256，完整性校验关闭时为 null。"
        },
        "sample_rate_hz": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 1,
          "description": "可选采样率（Hz），若未知或未记录则为 null。"
        }
      }
    },
    "backendInfo": {
      "type": "object",
      "description": "标识产出该结果的转写后端。",
      "required": [
        "name"
      ],
      "additionalProperties": true,
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "后端名称，例如 dummy/faster-whisper/whisper.cpp。"
        },
        "model": {
          "type": [
            "string",
            "null"
          ],
          "description": "可选模型标识，允许 null 表示未指定。"
        },
        "version": {
          "type": [
            "string",
            "null"
          ],
          "description": "可选后端版本号。"
        }
      }
    },
    "wordEntry": {
      "type": "object",
      "description": "单个词条，包含文本内容与时间戳。",
      "required": [
        "text",
        "start",
        "end",
        "segment_id",
        "index"
      ],
      "additionalProperties": false,
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "词条文本内容，保持原始大小写。"
        },
        "start": {
          "type": "number",
          "minimum": 0,
          "description": "词条起始时间（秒），非负浮点数。"
        },
        "end": {
          "type": "number",
          "minimum": 0,
          "description": "词条结束时间（秒），应大于等于 start。"
        },
        "confidence": {
          "type": [
            "number",
            "null"
          ],
          "minimum": 0,
          "maximum": 1,
          "description": "词级置信度，范围 0~1，若后端不返回则为 null。"
        },
        "segment_id": {
          "type": "integer",
          "minimum": 0,
          "description": "归属段 ID，用于在段级数组中建立关联。"
        },
        "index": {
          "type": "integer",
          "minimum": 0,
          "description": "词条在整段音频中的顺序索引，从 0 开始。"
        }
      }
    }
  }
}
